<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usu√°rios - Maiconsoft</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- √çcones Material Design -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <link rel="stylesheet" href="../css/notifications.css">
    
    <!-- Scripts de configura√ß√£o -->
    <script src="../js/config.js"></script>
</head>
<body>
    <!-- Container de Alertas -->
    <div id="alert-container"></div>

    <!-- Navigation Bar -->
    <nav style="background: #000000; padding: 1rem 0; box-shadow: 0 2px 20px rgba(0, 0, 0, 0.8); border-bottom: 2px solid #f59e0b;">
        <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem;">
            <div style="display: flex; align-items: center;">
                <a href="dashboard.html" style="text-decoration: none;">
                    <img src="../images/teste.webp" alt="Maiconsoft" style="height: 40px; width: auto;">
                </a>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <a href="dashboard.html" style="color: #ffffff; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s; border-radius: 6px;" onmouseover="this.style.background='#333333'" onmouseout="this.style.background='transparent'">
                    <span class="material-icons" style="font-size: 1.1rem;">dashboard</span>
                    Dashboard
                </a>
                <a href="clientes.html" style="color: #ffffff; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s; border-radius: 6px;" onmouseover="this.style.background='#333333'" onmouseout="this.style.background='transparent'">
                    <span class="material-icons" style="font-size: 1.1rem;">people</span>
                    Clientes
                </a>
                <a href="vendas.html" style="color: #ffffff; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s; border-radius: 6px;" onmouseover="this.style.background='#333333'" onmouseout="this.style.background='transparent'">
                    <span class="material-icons" style="font-size: 1.1rem;">trending_up</span>
                    Vendas
                </a>
                <a href="cupons.html" style="color: #ffffff; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s; border-radius: 6px;" onmouseover="this.style.background='#333333'" onmouseout="this.style.background='transparent'">
                    <span class="material-icons" style="font-size: 1.1rem;">local_offer</span>
                    Cupons
                </a>
                <a href="usuarios.html" style="color: #000000; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; background: #f59e0b; font-weight: 600; border-radius: 6px;">
                    <span class="material-icons" style="font-size: 1.1rem;">group</span>
                    Usu√°rios
                </a>
                <a href="relatorios.html" style="color: #ffffff; text-decoration: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s; border-radius: 6px;" onmouseover="this.style.background='#333333'" onmouseout="this.style.background='transparent'">
                    <span class="material-icons" style="font-size: 1.1rem;">assessment</span>
                    Relat√≥rios
                </a>
                
                <!-- Menu do Usu√°rio -->
                <div style="position: relative; display: inline-block;">
                    <button id="userMenuBtn" onclick="toggleUserMenu()" style="background: #333333; color: #ffffff; border: none; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; cursor: pointer; border-radius: 6px; transition: all 0.3s;" onmouseover="this.style.background='#444444'" onmouseout="this.style.background='#333333'">
                        <!-- Avatar circular -->
                        <div style="position: relative; width: 28px; height: 28px; border-radius: 50%; overflow: hidden; border: 2px solid #ffffff; background: #4b5563; display: flex; align-items: center; justify-content: center;">
                            <img id="userAvatarImage" src="" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                            <div id="userAvatarPlaceholder" style="color: #ffffff; font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; justify-content: center;">U</div>
                        </div>
                        <span id="userName">Usu√°rio</span>
                        <span class="material-icons" style="font-size: 1rem;">arrow_drop_down</span>
                    </button>
                    
                    <div id="userDropdown" style="display: none; position: absolute; right: 0; top: 100%; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border-radius: 8px; min-width: 200px; z-index: 1000; border: 1px solid #e5e7eb; margin-top: 0.5rem;">
                        <div style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;" id="userNameDisplay">Nome do Usu√°rio</div>
                            <div style="font-size: 0.8rem; color: #6b7280;" id="userRoleDisplay">Cargo</div>
                        </div>
                        
                        <a href="perfil.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: #374151; text-decoration: none; transition: all 0.3s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                            <span class="material-icons" style="font-size: 1.1rem; color: #3b82f6;">person</span>
                            Meu Perfil
                        </a>
                        
                        <a href="perfil.html#configuracoes" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: #374151; text-decoration: none; transition: all 0.3s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                            <span class="material-icons" style="font-size: 1.1rem; color: #6b7280;">settings</span>
                            Configura√ß√µes
                        </a>
                        
                        <div style="border-top: 1px solid #e5e7eb; margin: 0.5rem 0;"></div>
                        
                        <a href="#" onclick="fazerLogout()" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; color: #ef4444; text-decoration: none; transition: all 0.3s;" onmouseover="this.style.background='#fef2f2'" onmouseout="this.style.background='transparent'">
                            <span class="material-icons" style="font-size: 1.1rem;">logout</span>
                            Sair do Sistema
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Container Principal -->
    <div style="max-width: 1200px; margin: 0 auto; padding: 2rem; background: #f8fafc; min-height: calc(100vh - 70px);">
        
        <!-- Header da P√°gina -->
        <div style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('../images/usuarios.png') center/cover; padding: 1.5rem 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-bottom: 2rem; border-radius: 8px; position: relative;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 1.5rem; position: relative; z-index: 1;">
                <!-- T√≠tulo -->
                <div style="text-align: center;">
                    <h1 style="margin: 0 0 0.5rem 0; font-size: 1.75rem; font-weight: 700; color: #ffffff;">
                        Gest√£o de Usu√°rios
                    </h1>
                    <p style="margin: 0; color: #ffffff; font-size: 0.95rem;">Administra√ß√£o completa de usu√°rios, perfis e permiss√µes do sistema</p>
                </div>
                
                <!-- Bot√µes abaixo do t√≠tulo -->
                <div style="display: flex; gap: 1rem;">
                    <button onclick="switchUsuariosTab('resumo')" id="tab-resumo-btn" style="background: #f59e0b; color: #000000; border: 2px solid #000000; padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
                        <span class="material-icons" style="font-size: 1rem;">dashboard</span>
                        Resumo
                    </button>
                    <button onclick="switchUsuariosTab('criar')" id="tab-criar-btn" 
                           data-permission="usuarios:create"
                           style="background: transparent; color: #ffffff; border: 2px solid #ffffff; padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
                        <span class="material-icons" style="font-size: 1rem;">person_add</span>
                        Criar Usu√°rio
                    </button>
                    <button onclick="switchUsuariosTab('lista')" id="tab-lista-btn" style="background: transparent; color: #ffffff; border: 2px solid #ffffff; padding: 0.6rem 1.2rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem;">
                        <span class="material-icons" style="font-size: 1rem;">people</span>
                        Todos Usu√°rios
                    </button>
                </div>
            </div>
        </div>

        <!-- TAB: RESUMO DE USU√ÅRIOS -->
        <div id="tab-resumo" class="usuarios-tab-content" style="display: block;">
            <!-- M√©tricas Principais -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                <div style="background: white; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280; font-weight: 500;">Total de Usu√°rios</p>
                            <h3 style="margin: 0.5rem 0 0 0; font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="total-usuarios">0</h3>
                        </div>
                        <div style="background: transparent; padding: 0.75rem; display: flex; align-items: center; justify-content: center;">
                            <span class="material-icons" style="color: #6b7280; font-size: 1.5rem;">group</span>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280; font-weight: 500;">Usu√°rios Ativos</p>
                            <h3 style="margin: 0.5rem 0 0 0; font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="usuarios-ativos">0</h3>
                        </div>
                        <div style="background: transparent; padding: 0.75rem; display: flex; align-items: center; justify-content: center;">
                            <span class="material-icons" style="color: #6b7280; font-size: 1.5rem;">check_circle</span>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280; font-weight: 500;">Administradores</p>
                            <h3 style="margin: 0.5rem 0 0 0; font-size: 1.5rem; font-weight: 700; color: #1f2937;" id="admins-count">0</h3>
                        </div>
                        <div style="background: transparent; padding: 0.75rem; display: flex; align-items: center; justify-content: center;">
                            <span class="material-icons" style="color: #6b7280; font-size: 1.5rem;">admin_panel_settings</span>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 1.5rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280; font-weight: 500;">√öltimo Login</p>
                            <h3 style="margin: 0.5rem 0 0 0; font-size: 1rem; font-weight: 600; color: #1f2937;" id="ultimo-login">--</h3>
                        </div>
                        <div style="background: transparent; padding: 0.75rem; display: flex; align-items: center; justify-content: center;">
                            <span class="material-icons" style="color: #6b7280; font-size: 1.5rem;">schedule</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Permiss√µes do Sistema -->
            <div style="background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 2rem;">
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #374151; display: flex; align-items: center; gap: 0.5rem;">
                        <span class="material-icons" style="font-size: 1.2rem; color: #8b5cf6;">security</span>
                        N√≠veis de Permiss√£o
                    </h3>
                </div>
                <div style="padding: 1.5rem;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                        <div style="border: 1px solid #e5e7eb; padding: 1rem; background: #f9fafb;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="background: #dbeafe; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-icons" style="color: #3b82f6; font-size: 1.2rem;">person</span>
                                </div>
                                <h4 style="margin: 0; font-size: 1rem; font-weight: 600; color: #374151;">Funcion√°rio</h4>
                            </div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">Acesso restrito apenas ao m√≥dulo de Clientes. Pode visualizar e cadastrar clientes.</p>
                        </div>

                        <div style="border: 1px solid #e5e7eb; padding: 1rem; background: #f9fafb;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="background: #ede9fe; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-icons" style="color: #8b5cf6; font-size: 1.2rem;">admin_panel_settings</span>
                                </div>
                                <h4 style="margin: 0; font-size: 1rem; font-weight: 600; color: #374151;">Administrador</h4>
                            </div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">Acesso ao Dashboard, Clientes, Vendas e Relat√≥rios. Pode gerenciar opera√ß√µes do sistema.</p>
                        </div>

                        <div style="border: 1px solid #e5e7eb; padding: 1rem; background: #f9fafb;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div style="background: #d1fae5; padding: 0.5rem; display: flex; align-items: center; justify-content: center;">
                                    <span class="material-icons" style="color: #10b981; font-size: 1.2rem;">supervisor_account</span>
                                </div>
                                <h4 style="margin: 0; font-size: 1rem; font-weight: 600; color: #374151;">Diretor</h4>
                            </div>
                            <p style="margin: 0; font-size: 0.85rem; color: #6b7280;">Acesso completo ao sistema, incluindo gest√£o de usu√°rios e todas as funcionalidades administrativas.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: CRIAR USU√ÅRIO -->
        <div id="tab-criar" class="usuarios-tab-content" style="display: none;">
            <div style="background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                <form id="novo-usuario-form" style="padding: 0;">
                    <!-- Dados do Usu√°rio -->
                    <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; background: #f9fafb;">
                        <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem; font-weight: 600; color: #374151; display: flex; align-items: center; gap: 0.5rem;">
                            <span class="material-icons" style="font-size: 1.2rem; color: #3b82f6;">person_add</span>
                            Informa√ß√µes do Usu√°rio
                        </h3>
                        
                        <div style="margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Nome Completo *</label>
                                <input type="text" id="user-nome" required style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="Nome completo do usu√°rio">
                            </div>
                        </div>
                        
                        <!-- Aviso sobre c√≥digo de acesso autom√°tico -->
                        <div style="background: #eff6ff; border: 1px solid #bfdbfe; padding: 1rem; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span class="material-icons" style="color: #3b82f6; font-size: 1.2rem;">info</span>
                            <span style="color: #1e40af; font-size: 0.9rem;">O c√≥digo de acesso ser√° gerado automaticamente pelo sistema e exibido ap√≥s o cadastro.</span>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Email *</label>
                                <input type="email" id="user-email" required style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="usuario@maiconsoft.com">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">CPF *</label>
                                <input type="text" id="user-cpf" required style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="000.000.000-00">
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Telefone</label>
                                <input type="text" id="user-telefone" style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="(11) 99999-9999">
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Tipo de Usu√°rio *</label>
                                <select id="user-perfil" required style="width: 100%; padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;">
                                    <option value="">Selecione o tipo</option>
                                    <!-- Options ser√£o carregadas dinamicamente via JavaScript -->
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Senha Tempor√°ria *</label>
                                <div style="position: relative;">
                                    <input type="password" id="user-senha" required style="width: 100%; padding: 0.6rem 2.5rem 0.6rem 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="Senha inicial">
                                    <button type="button" onclick="togglePasswordVisibility('user-senha')" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; color: #6b7280; padding: 0.25rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" onmouseover="this.style.color='#f59e0b'" onmouseout="this.style.color='#6b7280'">
                                        <span class="material-icons" id="user-senha-icon" style="font-size: 1.2rem;">visibility_off</span>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Confirmar Senha *</label>
                                <div style="position: relative;">
                                    <input type="password" id="user-senha-confirm" required style="width: 100%; padding: 0.6rem 2.5rem 0.6rem 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 4px;" placeholder="Confirme a senha">
                                    <button type="button" onclick="togglePasswordVisibility('user-senha-confirm')" style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; color: #6b7280; padding: 0.25rem; display: flex; align-items: center; justify-content: center; transition: all 0.2s;" onmouseover="this.style.color='#f59e0b'" onmouseout="this.style.color='#6b7280'">
                                        <span class="material-icons" id="user-senha-confirm-icon" style="font-size: 1.2rem;">visibility_off</span>
                                    </button>
                                </div>
                            </div>
                        </div>


                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div style="padding: 1.5rem; background: #f9fafb; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                        <button type="button" onclick="limparFormularioUsuario()" 
                                style="background: transparent; color: #6b7280; border: 2px solid #d1d5db; padding: 0.7rem 1.2rem; cursor: pointer; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; border-radius: 4px; transition: all 0.2s;"
                                onmouseover="this.style.background='#ef4444'; this.style.color='white'; this.style.borderColor='#ef4444'"
                                onmouseout="this.style.background='transparent'; this.style.color='#6b7280'; this.style.borderColor='#d1d5db'">
                            <span class="material-icons" style="font-size: 1rem;">clear</span>
                            Limpar
                        </button>
                        
                        <div style="display: flex; gap: 0.75rem;">
                            <button type="button" onclick="gerarSenhaAleatoria()" 
                                    style="background: transparent; color: #6b7280; border: 2px solid #d1d5db; padding: 0.7rem 1.2rem; cursor: pointer; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; border-radius: 4px; transition: all 0.2s;"
                                    onmouseover="this.style.background='#f59e0b'; this.style.color='white'; this.style.borderColor='#f59e0b'"
                                    onmouseout="this.style.background='transparent'; this.style.color='#6b7280'; this.style.borderColor='#d1d5db'">
                                <span class="material-icons" style="font-size: 1rem;">shuffle</span>
                                Gerar Senha
                            </button>
                            <button type="submit" 
                                    style="background: transparent; color: #6b7280; border: 2px solid #d1d5db; padding: 0.7rem 1.5rem; cursor: pointer; font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; border-radius: 4px; transition: all 0.2s;"
                                    onmouseover="this.style.background='#10b981'; this.style.color='white'; this.style.borderColor='#10b981'"
                                    onmouseout="this.style.background='transparent'; this.style.color='#6b7280'; this.style.borderColor='#d1d5db'">
                                <span class="material-icons" style="font-size: 1rem;">person_add</span>
                                Criar Usu√°rio
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- TAB: LISTA DE USU√ÅRIOS -->
        <div id="tab-lista" class="usuarios-tab-content" style="display: none;">
            <div style="background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px;">
                <!-- Filtros e Busca -->
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                        <h3 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #374151;">Lista de Usu√°rios</h3>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <select id="filter-perfil" style="padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; background: white;">
                                <option value="">Todos os Perfis</option>
                                <option value="FUNCIONARIO">Funcion√°rio</option>
                                <option value="VENDEDOR">Vendedor</option>
                                <option value="DIRETOR">Diretor</option>
                                <option value="ADMIN">Administrador</option>
                            </select>
                            <select id="filter-status" style="padding: 0.6rem; border: 1px solid #d1d5db; font-size: 0.9rem; background: white;">
                                <option value="">Todos Status</option>
                                <option value="ativo">Ativo</option>
                                <option value="inativo">Inativo</option>
                            </select>
                            <input type="text" id="search-usuarios" placeholder="Buscar por nome ou email..." style="padding: 0.6rem 1rem; border: 1px solid #d1d5db; font-size: 0.9rem; min-width: 250px;">
                            <button onclick="buscarUsuarios()" style="background: #3b82f6; color: white; border: none; padding: 0.6rem 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons" style="font-size: 1rem;">search</span>
                                Buscar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Usu√°rios -->
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: #f9fafb;">
                            <tr>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">ID</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">Nome</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">Email</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">C√≥digo Acesso</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">Perfil</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">Status</th>
                                <th style="padding: 1rem; text-align: left; font-size: 0.85rem; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody">
                            <!-- Dados carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagina√ß√£o -->
                <div style="padding: 1.5rem; border-top: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: between;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <span style="font-size: 0.9rem; color: #6b7280;">Mostrando <strong id="showing-range">0-0</strong> de <strong id="total-records">0</strong> usu√°rios</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-left: auto;">
                        <button onclick="paginaAnterior()" id="btn-anterior" style="background: white; color: #6b7280; border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem;" disabled>
                            <span class="material-icons" style="font-size: 1rem;">chevron_left</span>
                        </button>
                        <span id="pagination-info" style="padding: 0.5rem 1rem; font-size: 0.9rem; color: #374151;">P√°gina 1 de 1</span>
                        <button onclick="proximaPagina()" id="btn-proximo" style="background: white; color: #6b7280; border: 1px solid #d1d5db; padding: 0.5rem 0.75rem; cursor: pointer; font-size: 0.85rem;" disabled>
                            <span class="material-icons" style="font-size: 1rem;">chevron_right</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Usu√°rio -->
    <div id="editUserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px;">
            <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #f8fafc;">
                <h2 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #374151; display: flex; align-items: center; gap: 0.5rem;">
                    <span class="material-icons" style="color: #3b82f6;">edit</span>
                    Editar Usu√°rio
                </h2>
                <button onclick="closeEditUserModal()" style="background: none; border: none; cursor: pointer; color: #6b7280; padding: 0.5rem;">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <form id="editUserForm" style="padding: 1.5rem;">
                <div id="editUserContent">
                    <!-- Formul√°rio ser√° inserido aqui -->
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                    <button type="button" onclick="closeEditUserModal()" style="padding: 0.75rem 1.5rem; border: 1px solid #d1d5db; background: white; color: #374151; cursor: pointer; font-size: 0.9rem; font-weight: 500; border-radius: 6px;">
                        Cancelar
                    </button>
                    <button type="submit" id="editUserSubmitBtn" style="padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; cursor: pointer; font-size: 0.9rem; font-weight: 500; border-radius: 6px;">
                        <span class="material-icons" style="font-size: 1rem; margin-right: 0.5rem;">save</span>
                        Salvar Altera√ß√µes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o de Exclus√£o -->
    <div id="deleteUserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; width: 90%; max-width: 400px; position: relative; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 8px;">
            <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background: #fef2f2;">
                <h2 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #dc2626; display: flex; align-items: center; gap: 0.5rem;">
                    <span class="material-icons" style="color: #dc2626;">warning</span>
                    Confirmar Exclus√£o
                </h2>
                <button onclick="closeDeleteUserModal()" style="background: none; border: none; cursor: pointer; color: #6b7280; padding: 0.5rem;">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div style="padding: 1.5rem;">
                <p style="margin: 0 0 1rem 0; color: #374151;">Tem certeza que deseja excluir este usu√°rio?</p>
                <p id="deleteUserInfo" style="margin: 0 0 1.5rem 0; color: #6b7280; font-size: 0.9rem; background: #f9fafb; padding: 1rem; border-radius: 6px;">
                    <!-- Informa√ß√µes do usu√°rio ser√£o inseridas aqui -->
                </p>
                <div style="display: flex; justify-content: flex-end; gap: 1rem;">
                    <button type="button" onclick="closeDeleteUserModal()" style="padding: 0.75rem 1.5rem; border: 1px solid #d1d5db; background: white; color: #374151; cursor: pointer; font-size: 0.9rem; font-weight: 500; border-radius: 6px;">
                        Cancelar
                    </button>
                    <button type="button" id="confirmDeleteBtn" style="padding: 0.75rem 1.5rem; background: #dc2626; color: white; border: none; cursor: pointer; font-size: 0.9rem; font-weight: 500; border-radius: 6px;">
                        <span class="material-icons" style="font-size: 1rem; margin-right: 0.5rem;">delete</span>
                        Excluir Usu√°rio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/app.js"></script>
    <script>
        // Estado da pagina√ß√£o
        let currentPage = 0;
        let pageSize = 10;
        let totalPages = 0;
        let totalElements = 0;

        // Fun√ß√£o de logout com notifica√ß√£o moderna
        function fazerLogout() {
            // Mostrar notifica√ß√£o de logout
            showLogoutNotification();
            
            // Executar logout ap√≥s 1.5 segundos
            setTimeout(() => {
                localStorage.removeItem('usuarioLogado');
                window.location.href = 'login.html';
            }, 1500);
        }
        
        function showLogoutNotification() {
            // Criar overlay de logout
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease-out;
            `;
            
            // Criar card de logout
            const logoutCard = document.createElement('div');
            logoutCard.style.cssText = `
                background: #1a1a1a;
                border: 2px solid #f59e0b;
                border-radius: 16px;
                padding: 2rem;
                text-align: center;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
                animation: slideIn 0.4s ease-out;
                max-width: 350px;
            `;
            
            logoutCard.innerHTML = `
                <div style="color: #f59e0b; font-size: 3rem; margin-bottom: 1rem;">
                    <span class="material-icons" style="font-size: 3rem;">logout</span>
                </div>
                <h3 style="color: white; margin: 0 0 0.5rem 0; font-size: 1.3rem; font-weight: 600;">
                    Saindo do sistema...
                </h3>
                <p style="color: #cccccc; margin: 0 0 1.5rem 0; font-size: 0.9rem;">
                    Obrigado por usar o Sistema Maiconsoft!
                </p>
                <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; color: #f59e0b;">
                    <div class="loading-spinner"></div>
                    <span style="font-size: 0.85rem; font-weight: 500;">Redirecionando...</span>
                </div>
            `;
            
            overlay.appendChild(logoutCard);
            document.body.appendChild(overlay);
            
            // Adicionar estilos de anima√ß√£o
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                
                @keyframes slideIn {
                    from { transform: scale(0.8) translateY(-20px); opacity: 0; }
                    to { transform: scale(1) translateY(0); opacity: 1; }
                }
                
                .loading-spinner {
                    width: 16px;
                    height: 16px;
                    border: 2px solid #333;
                    border-top: 2px solid #f59e0b;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        // Verificar se √© admin/diretor
        function checkAdminAccess() {
            // Verificar se usu√°rio est√° logado
            const usuarioLogado = localStorage.getItem('usuarioLogado');
            if (!usuarioLogado) {
                window.location.href = 'login.html';
                return false;
            }
            
            // Liberar acesso para todos os usu√°rios logados
            return true;
            
            const user = AppState.user;
            const userRole = user?.roleName?.toLowerCase();
            
            if (userRole !== 'admin' && userRole !== 'diretor') {
                // alert('Acesso negado! Apenas administradores e diretores podem acessar esta p√°gina.');
                showAlert('Acesso negado! Apenas administradores e diretores podem acessar esta p√°gina.', 'error');
                window.location.href = 'dashboard.html';
                return false;
            }
            return true;
        }

        // Gerenciar tabs
        function switchUsuariosTab(tabName) {
            // Ocultar todas as tabs
            const tabs = document.querySelectorAll('.usuarios-tab-content');
            tabs.forEach(tab => tab.style.display = 'none');
            
            // Resetar todos os bot√µes para estado n√£o selecionado (transparente com borda branca)
            document.getElementById('tab-resumo-btn').style.background = 'transparent';
            document.getElementById('tab-resumo-btn').style.color = '#ffffff';
            document.getElementById('tab-resumo-btn').style.border = '2px solid #ffffff';
            document.getElementById('tab-criar-btn').style.background = 'transparent';
            document.getElementById('tab-criar-btn').style.color = '#ffffff';
            document.getElementById('tab-criar-btn').style.border = '2px solid #ffffff';
            document.getElementById('tab-lista-btn').style.background = 'transparent';
            document.getElementById('tab-lista-btn').style.color = '#ffffff';
            document.getElementById('tab-lista-btn').style.border = '2px solid #ffffff';
            
            // Ativar tab selecionada (√¢mbar com borda preta)
            document.getElementById(`tab-${tabName}`).style.display = 'block';
            document.getElementById(`tab-${tabName}-btn`).style.background = '#f59e0b';
            document.getElementById(`tab-${tabName}-btn`).style.color = '#000000';
            document.getElementById(`tab-${tabName}-btn`).style.border = '2px solid #000000';
            
            // Carregar dados espec√≠ficos da tab
            if (tabName === 'resumo') {
                loadResumoMetricas();
            } else if (tabName === 'lista') {
                buscarUsuarios();
            } else if (tabName === 'criar') {
                // Carregar roles dispon√≠veis quando acessar a aba de cria√ß√£o
                loadAvailableRoles();
            }
        }

        // Carregar m√©tricas do resumo
        async function loadResumoMetricas() {
            try {
                const data = await APIService.users.getAll(0, 1000);
                const usuarios = data.content || data || [];
                
                // Calcular m√©tricas
                const total = usuarios.length;
                const ativos = usuarios.filter(u => u.ativo === true).length;
                const admins = usuarios.filter(u => u.roleName === 'ADMIN' || u.userRole?.roleName === 'ADMIN').length;
                
                // Atualizar interface
                document.getElementById('total-usuarios').textContent = total;
                document.getElementById('usuarios-ativos').textContent = ativos;
                document.getElementById('admins-count').textContent = admins;
                
                // √öltimo login (simulado)
                const ultimoLogin = usuarios.length > 0 ? formatDate(new Date()) : '--';
                document.getElementById('ultimo-login').textContent = ultimoLogin;
            } catch (error) {
                console.error('Erro ao carregar m√©tricas:', error);
                // Fallback para dados mocados
                document.getElementById('total-usuarios').textContent = '1';
                document.getElementById('usuarios-ativos').textContent = '1';
                document.getElementById('admins-count').textContent = '1';
                document.getElementById('ultimo-login').textContent = 'Hoje 14:30';
            }
        }

        // Fun√ß√£o para recarregar lista de usu√°rios
        async function loadUsuarios() {
            await buscarUsuarios();
        }

        // Buscar usu√°rios com pagina√ß√£o
        async function buscarUsuarios() {
            console.log('üîç Iniciando busca de usu√°rios...');
            const searchTerm = document.getElementById('search-usuarios')?.value || '';
            const filterRole = document.getElementById('filter-perfil')?.value || '';
            const filterStatus = document.getElementById('filter-status')?.value || '';
            
            try {
                console.log('üì° Fazendo chamada para API...');
                const data = await APIService.users.getAll(currentPage, pageSize);
                console.log('‚úÖ Dados recebidos da API:', data);
                displayUsuariosPaginados(data);
                updatePaginationInfo(data);
            } catch (error) {
                console.log('‚ùå Erro na API, usando dados mocados:', error);
                displayUsuariosMocados();
            }
        }

        // Dados mocados para demonstra√ß√£o
        function displayUsuariosMocados() {
            const mockData = {
                content: [
                    { 
                        id: 1, 
                        nome: 'Jo√£o Admin', 
                        email: 'admin@maiconsoft.com', 
                        roleName: 'ADMIN',
                        status: 'ativo',
                        ultimoAcesso: '2024-01-15T14:30:00'
                    },
                    { 
                        id: 2, 
                        nome: 'Maria Diretor', 
                        email: 'diretor@maiconsoft.com', 
                        roleName: 'DIRETOR',
                        status: 'ativo',
                        ultimoAcesso: '2024-01-15T10:15:00'
                    },
                    { 
                        id: 3, 
                        nome: 'Pedro Funcion√°rio', 
                        email: 'funcionario@maiconsoft.com', 
                        roleName: 'FUNCIONARIO',
                        status: 'ativo',
                        ultimoAcesso: '2024-01-14T16:45:00'
                    }
                ],
                totalElements: 3,
                totalPages: 1,
                number: 0
            };
            
            displayUsuariosPaginados(mockData);
            updatePaginationInfo(mockData);
        }

        // Exibir usu√°rios na tabela
        function displayUsuariosPaginados(data) {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';
            
            // Verificar se data √© um array ou objeto com content
            const usuarios = Array.isArray(data) ? data : (data.content || []);
            
            console.log('üìã Dados recebidos para exibir:', usuarios);
            
            if (usuarios.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem; color: #6b7280;">
                            <span class="material-icons" style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem; display: block;">search_off</span>
                            Nenhum usu√°rio encontrado
                        </td>
                    </tr>
                `;
                return;
            }
            
            usuarios.forEach(user => {
                const row = tbody.insertRow();
                row.style.borderBottom = '1px solid #e5e7eb';
                
                // Mapear campos do backend (adjust para a estrutura real)
                const userId = user.id || user.idUser || user.id_user;
                const userName = user.nome || user.name;
                const userEmail = user.email;
                const userRole = user.roleName || user.userRole?.roleName || 'FUNCIONARIO';
                const userStatus = user.ativo ? 'ATIVO' : 'INATIVO';
                const userAccess = user.createdAt || user.created_at || new Date().toISOString();
                const userCode = user.codigoAcesso || 'N/A';
                
                const roleColor = getRoleColor(userRole);
                const statusColor = getStatusColor(userStatus);
                
                row.innerHTML = `
                    <td style="padding: 1rem; font-size: 0.9rem; color: #374151;">${userId}</td>
                    <td style="padding: 1rem; font-size: 0.9rem; color: #374151; font-weight: 500;">${userName}</td>
                    <td style="padding: 1rem; font-size: 0.9rem; color: #6b7280;">${userEmail}</td>
                    <td style="padding: 1rem; font-size: 0.8rem; color: #6b7280;">${userCode}</td>
                    <td style="padding: 1rem;">
                        <span style="background: transparent; color: ${roleColor.text}; border: 2px solid ${roleColor.border}; padding: 0.3rem 0.6rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; border-radius: 4px;">
                            ${userRole}
                        </span>
                    </td>
                    <td style="padding: 1rem;">
                        <span style="background: transparent; color: ${statusColor.text}; border: 2px solid ${statusColor.border}; padding: 0.3rem 0.6rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; border-radius: 4px;">
                            ${userStatus}
                        </span>
                    </td>
                    <td style="padding: 1rem;">
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="editUser(${userId})" 
                                    style="background: transparent; color: #6b7280; border: 2px solid #d1d5db; padding: 0.4rem 0.6rem; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; border-radius: 4px; transition: all 0.2s;"
                                    onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#9ca3af'"
                                    onmouseout="this.style.background='transparent'; this.style.borderColor='#d1d5db'">
                                <span class="material-icons" style="font-size: 0.9rem;">edit</span>
                                Editar
                            </button>
                            <button onclick='deleteUser(${userId}, ${JSON.stringify({nome: userName, email: userEmail, codigoAcesso: userCode, ativo: user.ativo})})' 
                                    style="background: transparent; color: #6b7280; border: 2px solid #d1d5db; padding: 0.4rem 0.6rem; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; border-radius: 4px; transition: all 0.2s;"
                                    onmouseover="this.style.background='#f3f4f6'; this.style.borderColor='#9ca3af'"
                                    onmouseout="this.style.background='transparent'; this.style.borderColor='#d1d5db'">
                                <span class="material-icons" style="font-size: 0.9rem;">delete</span>
                                Excluir
                            </button>
                        </div>
                    </td>
                `;
            });
        }

        // Atualizar informa√ß√µes de pagina√ß√£o
        function updatePaginationInfo(data) {
            totalPages = data.totalPages || 1;
            totalElements = data.totalElements || 0;
            currentPage = data.number || 0;
            
            const startItem = currentPage * pageSize + 1;
            const endItem = Math.min((currentPage + 1) * pageSize, totalElements);
            
            document.getElementById('showing-range').textContent = `${startItem}-${endItem}`;
            document.getElementById('total-records').textContent = totalElements;
            document.getElementById('pagination-info').textContent = `P√°gina ${currentPage + 1} de ${totalPages}`;
            
            // Atualizar bot√µes de navega√ß√£o
            const btnAnterior = document.getElementById('btn-anterior');
            const btnProximo = document.getElementById('btn-proximo');
            
            btnAnterior.disabled = currentPage === 0;
            btnProximo.disabled = currentPage >= totalPages - 1;
            
            btnAnterior.style.opacity = currentPage === 0 ? '0.5' : '1';
            btnProximo.style.opacity = currentPage >= totalPages - 1 ? '0.5' : '1';
        }

        // Navega√ß√£o de p√°ginas
        function paginaAnterior() {
            if (currentPage > 0) {
                currentPage--;
                buscarUsuarios();
            }
        }

        function proximaPagina() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                buscarUsuarios();
            }
        }

        // Criar novo usu√°rio
        async function criarNovoUsuario(event) {
            event.preventDefault();
            
            const senha = document.getElementById('user-senha').value;
            const senhaConfirm = document.getElementById('user-senha-confirm').value;
            
            if (senha !== senhaConfirm) {
                // alert('As senhas n√£o coincidem!');
                showAlert('As senhas n√£o coincidem!', 'error');
                return;
            }
            
            // Dados conforme UserRequestDTO do backend
            const userData = {
                nome: document.getElementById('user-nome').value,
                email: document.getElementById('user-email').value,
                cpf: document.getElementById('user-cpf').value,
                telefone: document.getElementById('user-telefone').value,
                senha: senha,
                roleName: document.getElementById('user-perfil').value || 'FUNCIONARIO', // Usar roleName em vez de tipoUsuario
                ativo: true // Usu√°rio ativo por padr√£o
            };

            try {
                // Debug para verificar APIService
                console.log('üîç Verificando APIService:', {
                    'window.APIService existe': typeof window.APIService,
                    'APIService existe': typeof APIService,
                    'APIService.users existe': typeof APIService?.users,
                    'APIService.users.create existe': typeof APIService?.users?.create
                });

                if (!APIService?.users?.create) {
                    throw new Error('APIService.users.create n√£o est√° dispon√≠vel. Verifique se config.js foi carregado corretamente.');
                }

                // Usar APIService para criar usu√°rio
                const result = await APIService.users.create(userData);
                
                // Exibir modal com c√≥digo de acesso gerado
                mostrarCodigoAcesso(result.codigoAcesso, userData.nome);
                
                limparFormularioUsuario();
                switchUsuariosTab('resumo');
                loadResumoMetricas();
                loadUsuarios(); // Recarregar lista de usu√°rios
                
            } catch (error) {
                console.error('Erro ao criar usu√°rio:', error);
                // alert(`Erro ao criar usu√°rio: ${error.message}`);
                showAlert(`Erro ao criar usu√°rio: ${error.message}`, 'error');
            }
        }

        // Fun√ß√£o para exibir o c√≥digo de acesso gerado
        function mostrarCodigoAcesso(codigoAcesso, nomeUsuario) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; 
                top: 0; left: 0; right: 0; bottom: 0; 
                background: rgba(0,0,0,0.8); 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 2rem; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="color: #10b981; margin-bottom: 1rem;">
                        <span class="material-icons" style="font-size: 3rem;">check_circle</span>
                    </div>
                    <h2 style="margin: 0 0 1rem 0; color: #1f2937;">Usu√°rio Criado com Sucesso!</h2>
                    <p style="margin: 0 0 1.5rem 0; color: #6b7280;">O usu√°rio <strong>${nomeUsuario}</strong> foi cadastrado no sistema.</p>
                    
                    <div style="background: #f3f4f6; padding: 1.5rem; margin: 1.5rem 0; border-left: 4px solid #10b981;">
                        <h3 style="margin: 0 0 0.5rem 0; color: #1f2937;">C√≥digo de Acesso Gerado:</h3>
                        <div style="font-size: 2rem; font-weight: bold; color: #10b981; font-family: monospace; letter-spacing: 2px;">${codigoAcesso}</div>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #ef4444;">‚ö†Ô∏è Anote este c√≥digo! Ser√° necess√°rio para o primeiro login.</p>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="copiarCodigo('${codigoAcesso}')" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <span class="material-icons" style="font-size: 1rem;">copy</span>
                            Copiar C√≥digo
                        </button>
                        <button onclick="fecharModal()" style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;">
                            <span class="material-icons" style="font-size: 1rem;">check</span>
                            Entendi
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fechar modal ao clicar fora
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    fecharModal();
                }
            });
        }

        // Fun√ß√£o para copiar c√≥digo para √°rea de transfer√™ncia
        function copiarCodigo(codigo) {
            navigator.clipboard.writeText(codigo).then(() => {
                // alert('C√≥digo copiado para a √°rea de transfer√™ncia!');
                // showAlert('C√≥digo copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                // Fallback para navegadores mais antigos
                const textarea = document.createElement('textarea');
                textarea.value = codigo;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                // alert('C√≥digo copiado para a √°rea de transfer√™ncia!');
                // showAlert('C√≥digo copiado para a √°rea de transfer√™ncia!', 'success');
            });
        }

        // Fun√ß√£o para fechar modal
        function fecharModal() {
            const modal = document.querySelector('div[style*="position: fixed"]');
            if (modal) {
                modal.remove();
            }
        }

        // Limpar formul√°rio
        function limparFormularioUsuario() {
            document.getElementById('novo-usuario-form').reset();
        }

        // Gerar senha aleat√≥ria
        function gerarSenhaAleatoria() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%';
            let senha = '';
            for (let i = 0; i < 8; i++) {
                senha += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            document.getElementById('user-senha').value = senha;
            document.getElementById('user-senha-confirm').value = senha;
        }

        // Alternar visibilidade da senha
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(inputId + '-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'visibility';
            } else {
                input.type = 'password';
                icon.textContent = 'visibility_off';
            }
        }

        // Fun√ß√µes auxiliares
        function getRoleColor(role) {
            switch(role?.toUpperCase()) {
                case 'ADMIN': 
                    return { border: '#7c3aed', text: '#7c3aed' };
                case 'DIRETOR': 
                    return { border: '#d97706', text: '#d97706' };
                case 'FUNCIONARIO': 
                    return { border: '#1d4ed8', text: '#1d4ed8' };
                case 'VENDEDOR': 
                    return { border: '#059669', text: '#059669' };
                default: 
                    return { border: '#6b7280', text: '#6b7280' };
            }
        }

        function getStatusColor(status) {
            switch(status?.toUpperCase()) {
                case 'ATIVO': 
                    return { border: '#059669', text: '#059669' };
                case 'INATIVO': 
                    return { border: '#dc2626', text: '#dc2626' };
                default: 
                    return { border: '#059669', text: '#059669' };
            }
        }

        function formatDate(dateString) {
            if (!dateString) return null;
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        async function editUser(id) {
            console.log('‚úèÔ∏è Editar usu√°rio:', id);
            
            try {
                // Buscar dados do usu√°rio
                const user = await APIService.users.getById(id);
                console.log('üìã Dados do usu√°rio para edi√ß√£o:', user);
                
                // Montar formul√°rio de edi√ß√£o
                const formContent = `
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Nome Completo *</label>
                            <input type="text" name="nome" value="${user.nome || ''}" required
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; font-size: 0.9rem; border-radius: 6px;">
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">E-mail *</label>
                            <input type="email" name="email" value="${user.email || ''}" required
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; font-size: 0.9rem; border-radius: 6px;">
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">C√≥digo de Acesso *</label>
                            <input type="text" name="codigoAcesso" value="${user.codigoAcesso || ''}" readonly
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; background: #f9fafb; color: #6b7280; font-size: 0.9rem; border-radius: 6px;">
                            <small style="color: #6b7280; font-size: 0.75rem;">O c√≥digo de acesso n√£o pode ser alterado</small>
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Nova Senha</label>
                            <input type="password" name="senha" placeholder="Deixe em branco para manter a senha atual"
                                   style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; font-size: 0.9rem; border-radius: 6px;">
                            <small style="color: #6b7280; font-size: 0.75rem;">M√≠nimo 6 caracteres. Deixe em branco para n√£o alterar.</small>
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Tipo de Usu√°rio *</label>
                            <select name="roleName" id="edit-user-role" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; font-size: 0.9rem; border-radius: 6px;">
                                <!-- Options ser√£o carregadas dinamicamente via JavaScript -->
                            </select>
                            <small style="color: #6b7280; font-size: 0.75rem;">Define as permiss√µes do usu√°rio no sistema</small>
                        </div>
                        
                        <div>
                            <label style="display: block; font-size: 0.85rem; font-weight: 600; color: #374151; margin-bottom: 0.4rem;">Status</label>
                            <select name="ativo" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; font-size: 0.9rem; border-radius: 6px;">
                                <option value="true" ${user.ativo ? 'selected' : ''}>Ativo</option>
                                <option value="false" ${!user.ativo ? 'selected' : ''}>Inativo</option>
                            </select>
                        </div>
                        
                        <input type="hidden" name="id" value="${user.idUser || user.id || user.id_user}">
                    </div>
                `;
                
                // Inserir conte√∫do no modal
                document.getElementById('editUserContent').innerHTML = formContent;
                
                // Atualizar dropdown de roles com o valor atual do usu√°rio
                const currentRoleName = user.roleName || user.userRole?.roleName || 'FUNCIONARIO';
                await updateEditRoleDropdown(currentRoleName);
                
                // Configurar evento de submit
                const editForm = document.getElementById('editUserForm');
                editForm.onsubmit = function(e) {
                    e.preventDefault();
                    saveUserChanges(id);
                };
                
                // Mostrar modal
                const modal = document.getElementById('editUserModal');
                modal.style.display = 'flex';
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar usu√°rio para edi√ß√£o:', error);
                showAlert('Erro ao carregar dados do usu√°rio: ' + error.message, 'error');
            }
        }

        function deleteUser(id, userData) {
            console.log('üóëÔ∏è Preparando exclus√£o do usu√°rio:', id, userData);
            
            try {
                // Preencher informa√ß√µes no modal de confirma√ß√£o
                const userInfo = document.getElementById('deleteUserInfo');
                if (!userInfo) {
                    throw new Error('Elemento deleteUserInfo n√£o encontrado');
                }
                
                userInfo.innerHTML = `
                    <strong>Nome:</strong> ${userData.nome || 'N/A'}<br>
                    <strong>E-mail:</strong> ${userData.email || 'N/A'}<br>
                    <strong>C√≥digo:</strong> ${userData.codigoAcesso || 'N/A'}<br>
                    <strong>Status:</strong> ${userData.ativo ? 'Ativo' : 'Inativo'}
                `;
                
                // Configurar bot√£o de confirma√ß√£o
                const confirmBtn = document.getElementById('confirmDeleteBtn');
                confirmBtn.onclick = function() {
                    confirmDeleteUser(id);
                };
                
                // Mostrar modal
                const modal = document.getElementById('deleteUserModal');
                modal.style.display = 'flex';
                
            } catch (error) {
                console.error('‚ùå Erro ao preparar exclus√£o:', error);
                showAlert('Erro ao preparar exclus√£o: ' + error.message, 'error');
            }
        }

        function closeEditUserModal() {
            console.log('‚ùå Fechando modal de edi√ß√£o de usu√°rio');
            const modal = document.getElementById('editUserModal');
            modal.style.display = 'none';
            
            // Limpar formul√°rio
            const form = document.getElementById('editUserForm');
            if (form) {
                form.reset();
            }
        }

        function closeDeleteUserModal() {
            console.log('‚ùå Fechando modal de confirma√ß√£o de exclus√£o');
            const modal = document.getElementById('deleteUserModal');
            modal.style.display = 'none';
            
            // Limpar informa√ß√µes
            const userInfo = document.getElementById('deleteUserInfo');
            if (userInfo) {
                userInfo.innerHTML = '';
            }
        }

        async function saveUserChanges(userId) {
            console.log('üíæ Salvando altera√ß√µes do usu√°rio:', userId);
            
            try {
                const form = document.getElementById('editUserForm');
                const formData = new FormData(form);
                
                // Buscar dados atuais do usu√°rio para manter campos obrigat√≥rios
                const currentUser = await APIService.users.getById(userId);
                
                const userData = {
                    nome: formData.get('nome'),
                    email: formData.get('email'),
                    cpf: currentUser.cpf, // Manter CPF existente
                    telefone: currentUser.telefone || '', // Manter telefone existente
                    ativo: formData.get('ativo') === 'true',
                    roleName: formData.get('roleName') || 'FUNCIONARIO' // Usar roleName em vez de tipoUsuario
                };
                
                // Adicionar senha apenas se foi preenchida
                const senha = formData.get('senha');
                if (senha && senha.trim()) {
                    userData.senha = senha;
                }
                
                console.log('üì§ Dados para atualiza√ß√£o:', userData);
                
                // Chamar API para atualizar usu√°rio
                const result = await APIService.users.update(userId, userData);
                console.log('‚úÖ Usu√°rio atualizado com sucesso:', result);
                
                // showAlert('Usu√°rio atualizado com sucesso!', 'success');
                closeEditUserModal();
                
                // Recarregar lista de usu√°rios
                buscarUsuarios();
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar altera√ß√µes do usu√°rio:', error);
                showAlert('Erro ao salvar altera√ß√µes: ' + error.message, 'error');
            }
        }

        async function confirmDeleteUser(userId) {
            console.log('üóëÔ∏è Confirmando exclus√£o do usu√°rio:', userId);
            
            try {
                // Chamar API para deletar usu√°rio
                await APIService.users.delete(userId);
                console.log('‚úÖ Usu√°rio exclu√≠do com sucesso');
                
                // showAlert('Usu√°rio exclu√≠do com sucesso!', 'success');
                closeDeleteUserModal();
                
                // Recarregar lista de usu√°rios
                buscarUsuarios();
                
            } catch (error) {
                console.error('‚ùå Erro ao excluir usu√°rio:', error);
                showAlert('Erro ao excluir usu√°rio: ' + error.message, 'error');
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            if (checkAdminAccess()) {
                // Configurar form submit
                document.getElementById('novo-usuario-form').addEventListener('submit', criarNovoUsuario);
                
                // Configurar busca
                document.getElementById('search-usuarios')?.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        currentPage = 0;
                        buscarUsuarios();
                    }
                });
                
                // Carregar dados iniciais
                loadResumoMetricas();
                
                // Carregar lista de usu√°rios se a aba lista estiver ativa
                const activeTab = document.querySelector('.usuarios-tab-content[style*="block"]');
                if (activeTab && activeTab.id === 'tab-lista') {
                    buscarUsuarios();
                }
                
                // Configurar event listeners para modais
                setupModalEventListeners();
            }
        });

        function setupModalEventListeners() {
            // Event listeners para fechar modais clicando no fundo
            const editModal = document.getElementById('editUserModal');
            if (editModal) {
                editModal.addEventListener('click', function(e) {
                    if (e.target === editModal) {
                        closeEditUserModal();
                    }
                });
            }

            const deleteModal = document.getElementById('deleteUserModal');
            if (deleteModal) {
                deleteModal.addEventListener('click', function(e) {
                    if (e.target === deleteModal) {
                        closeDeleteUserModal();
                    }
                });
            }

            // Event listener para ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const editModal = document.getElementById('editUserModal');
                    const deleteModal = document.getElementById('deleteUserModal');
                    
                    if (editModal && editModal.style.display === 'flex') {
                        closeEditUserModal();
                    }
                    if (deleteModal && deleteModal.style.display === 'flex') {
                        closeDeleteUserModal();
                    }
                }
            });
        }
    </script>
    
    <style>
        .perfil-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .perfil-badge.funcionario {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .perfil-badge.admin {
            background-color: #fff3e0;
            color: #f57c00;
        }
        
        .perfil-badge.diretor {
            background-color: #e8f5e8;
            color: #388e3c;
        }
        
        .status-badge.ativo {
            background-color: #e8f5e8;
            color: #388e3c;
        }
        
        .status-badge.inativo {
            background-color: #ffebee;
            color: #d32f2f;
        }
    </style>

    <script>
        // Sistema de Permiss√µes Integrado
        
        // Verifica√ß√£o de permiss√µes e inicializa√ß√£o
        function initPermissions() {
            console.log('üîê Inicializando sistema de permiss√µes...');
            
            // Verificar se o usu√°rio pode acessar esta p√°gina
            if (!PermissionManager.hasPermission(PERMISSIONS.USUARIOS.VIEW)) {
                PermissionManager.showPermissionError('acessar a p√°gina de usu√°rios');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
                return false;
            }
            
            const user = PermissionManager.getCurrentUser();
            console.log('üë§ Usu√°rio atual:', user);
            console.log('üé≠ Permiss√µes:', PermissionManager.getUserPermissions());
            
            setupPagePermissions();
            return true;
        }

        // Fun√ß√£o para criar usu√°rio com verifica√ß√£o de permiss√£o
        async function criarNovoUsuarioComPermissao() {
            return checkPermissionAndExecute(
                PERMISSIONS.USUARIOS.CREATE,
                () => criarNovoUsuario(),
                'criar novos usu√°rios'
            );
        }

        // Fun√ß√£o para editar usu√°rio com verifica√ß√£o de permiss√£o
        function editUserComPermissao(userId) {
            return checkPermissionAndExecute(
                PERMISSIONS.USUARIOS.EDIT,
                () => editUser(userId),
                'editar usu√°rios'
            );
        }

        // Fun√ß√£o para deletar usu√°rio com verifica√ß√£o de permiss√£o
        function deleteUserComPermissao(userId) {
            // Verificar permiss√£o de delete
            if (!PermissionManager.hasPermission(PERMISSIONS.USUARIOS.DELETE)) {
                PermissionManager.showPermissionError('excluir usu√°rios');
                return false;
            }
            
            // Verifica√ß√£o adicional para admins n√£o poderem deletar outros admins
            const currentUser = PermissionManager.getCurrentUser();
            const targetUser = usuarios.find(u => u.id === userId);
            
            if (targetUser && targetUser.roleName === 'ADMIN' && currentUser.roleName !== 'ADMIN') {
                // alert('‚ùå Apenas administradores podem excluir outros administradores!');
                showAlert('Apenas administradores podem excluir outros administradores!', 'error');
                return false;
            }
            
            return deleteUser(userId);
        }

        // Demonstra√ß√£o de uso das permiss√µes
        function demonstrarPermissoes() {
            const user = PermissionManager.getCurrentUser();
            console.log('=== DEMONSTRA√á√ÉO DO SISTEMA DE PERMISS√ïES ===');
            console.log('Usu√°rio atual:', user.nome, `(${user.roleName})`);
            console.log('');
            
            // Testar permiss√µes espec√≠ficas
            const testPermissions = [
                PERMISSIONS.USUARIOS.CREATE,
                PERMISSIONS.USUARIOS.EDIT,
                PERMISSIONS.USUARIOS.DELETE,
                PERMISSIONS.USUARIOS.CHANGE_PERMISSIONS,
                PERMISSIONS.CLIENTES.VIEW,
                PERMISSIONS.VENDAS.CREATE,
                PERMISSIONS.RELATORIOS.VIEW,
                PERMISSIONS.SISTEMA.ADMIN
            ];
            
            testPermissions.forEach(permission => {
                const hasPermission = PermissionManager.hasPermission(permission);
                console.log(`${hasPermission ? '‚úÖ' : '‚ùå'} ${permission}`);
            });
            
            console.log('');
            console.log('P√°ginas acess√≠veis:', PermissionManager.getAccessiblePages());
            console.log('==============================================');
        }

        // Disponibilizar fun√ß√£o global para testes
        window.demonstrarPermissoes = demonstrarPermissoes;
        
        // Fun√ß√£o para toggle do menu do usu√°rio
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
            }
        }
        
        // Fechar dropdown quando cliccar fora
        document.addEventListener('click', function(event) {
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userDropdown = document.getElementById('userDropdown');
            
            if (userMenuBtn && userDropdown && !userMenuBtn.contains(event.target) && !userDropdown.contains(event.target)) {
                userDropdown.style.display = 'none';
            }
        });
        
        // Carregar dados do usu√°rio
        async function loadUserDataNav() {
            try {
                // Buscar dados atualizados do backend
                const user = await updateUserDataFromBackend();
                if (user) {
                    const userName = user.nome || user.name || 'Usu√°rio';
                    
                    const userNameEl = document.getElementById('userName');
                    const userNameDisplayEl = document.getElementById('userNameDisplay');
                    const userRoleDisplayEl = document.getElementById('userRoleDisplay');
                    
                    // Mostrar apenas o primeiro nome no bot√£o
                    if (userNameEl) userNameEl.textContent = userName.split(' ')[0]; // Primeiro nome
                    if (userNameDisplayEl) userNameDisplayEl.textContent = userName;
                    if (userRoleDisplayEl) userRoleDisplayEl.textContent = getRoleDisplayName(user.tipoUsuario || user.roleName || 'FUNCIONARIO');
                    
                    // Carregar foto de perfil na navbar
                    loadUserProfilePhoto(user);
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
            }
        }
        
        // Fun√ß√£o para carregar foto de perfil na navbar
        function loadUserProfilePhoto(user) {
            const avatarImage = document.getElementById('userAvatarImage');
            const avatarPlaceholder = document.getElementById('userAvatarPlaceholder');
            
            if (user?.profilePhotoPath) {
                const imageUrl = `${APIService.baseURL.replace('/api', '')}/${user.profilePhotoPath}`;
                
                // Configurar eventos de carregamento
                avatarImage.onload = () => {
                    avatarImage.style.display = 'block';
                    avatarPlaceholder.style.display = 'none';
                };
                
                avatarImage.onerror = () => {
                    console.warn('Erro ao carregar foto de perfil na navbar:', imageUrl);
                    avatarImage.style.display = 'none';
                    avatarPlaceholder.style.display = 'flex';
                };
                
                avatarImage.src = imageUrl;
            } else {
                // Mostrar placeholder com inicial do nome
                avatarImage.style.display = 'none';
                avatarPlaceholder.style.display = 'flex';
                
                const firstLetter = (user?.nome || user?.name || 'U').charAt(0).toUpperCase();
                avatarPlaceholder.textContent = firstLetter;
                avatarPlaceholder.style.fontSize = '0.8rem';
            }
        }
        
        // Fun√ß√£o para obter nome do cargo
        function getRoleDisplayName(role) {
            const roles = {
                'FUNCIONARIO': 'Funcion√°rio',
                'VENDEDOR': 'Vendedor',
                'SUPERVISOR': 'Supervisor',
                'GERENTE': 'Gerente',
                'DIRETOR': 'Diretor',
                'ADMIN': 'Administrador'
            };
            return roles[role] || role || 'Funcion√°rio';
        }

        // Carregar roles dispon√≠veis para dropdowns
        async function loadAvailableRoles() {
            try {
                console.log('üîÑ Carregando roles dispon√≠veis...');
                const roles = await UserRoleService.getAllRoles();
                console.log('üìã Roles carregadas:', roles);
                
                // Atualizar dropdown de cria√ß√£o de usu√°rio
                const createRoleSelect = document.getElementById('user-perfil');
                if (createRoleSelect) {
                    createRoleSelect.innerHTML = '<option value="">Selecione o tipo</option>';
                    roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.roleName;
                        option.textContent = UserRoleService.getRoleDisplayName(role.roleName);
                        createRoleSelect.appendChild(option);
                    });
                }
                
                console.log('‚úÖ Dropdowns de roles atualizados');
            } catch (error) {
                console.error('‚ùå Erro ao carregar roles:', error);
                console.log('üîÑ Aplicando fallback para roles padr√£o...');
                
                // Fallback para roles padr√£o
                const createRoleSelect = document.getElementById('user-perfil');
                if (createRoleSelect) {
                    createRoleSelect.innerHTML = `
                        <option value="">Selecione o tipo</option>
                        <option value="FUNCIONARIO">Funcion√°rio</option>
                        <option value="VENDEDOR">Vendedor</option>
                        <option value="DIRETOR">Diretor</option>
                        <option value="ADMIN">Administrador</option>
                    `;
                    console.log('‚úÖ Fallback aplicado - dropdown preenchido com roles padr√£o');
                } else {
                    console.error('‚ùå Elemento #user-perfil n√£o encontrado para fallback');
                }
            }
        }

        // Atualizar dropdown de edi√ß√£o com roles dispon√≠veis
        async function updateEditRoleDropdown(currentRoleName = null) {
            try {
                const roles = await UserRoleService.getAllRoles();
                const editRoleSelect = document.getElementById('edit-user-role');
                
                if (editRoleSelect) {
                    editRoleSelect.innerHTML = '';
                    roles.forEach(role => {
                        const option = document.createElement('option');
                        option.value = role.roleName;
                        option.textContent = UserRoleService.getRoleDisplayName(role.roleName);
                        option.selected = role.roleName === currentRoleName;
                        editRoleSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('‚ùå Erro ao atualizar dropdown de edi√ß√£o:', error);
                // Fallback
                const editRoleSelect = document.getElementById('edit-user-role');
                if (editRoleSelect) {
                    const roles = ['FUNCIONARIO', 'VENDEDOR', 'DIRETOR', 'ADMIN'];
                    editRoleSelect.innerHTML = '';
                    roles.forEach(roleName => {
                        const option = document.createElement('option');
                        option.value = roleName;
                        option.textContent = UserRoleService.getRoleDisplayName(roleName);
                        option.selected = roleName === currentRoleName;
                        editRoleSelect.appendChild(option);
                    });
                }
            }
        }

        // Integrar verifica√ß√µes de permiss√£o nas fun√ß√µes existentes
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üìÑ P√°gina de usu√°rios carregada');
            
            // Carregar dados do usu√°rio para navbar
            await loadUserDataNav();
            
            // Verificar permiss√µes antes de inicializar
            if (!initPermissions()) {
                return;
            }
            
            // Configurar sistema de permiss√µes
            setupPagePermissions();
            
            // Adicionar efeitos hover nos bot√µes de tab
            const tabButtons = ['tab-resumo-btn', 'tab-criar-btn', 'tab-lista-btn'];
            tabButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('mouseenter', function() {
                        // Se n√£o estiver selecionado (transparente), hover branco suave
                        if (this.style.background === 'transparent') {
                            this.style.background = 'rgba(255, 255, 255, 0.1)';
                        }
                    });
                    btn.addEventListener('mouseleave', function() {
                        // Se n√£o estiver selecionado, voltar para transparente
                        if (this.style.background === 'rgba(255, 255, 255, 0.1)') {
                            this.style.background = 'transparent';
                        }
                    });
                }
            });
            
            // Verificar se o formul√°rio de usu√°rios deve estar dispon√≠vel
            const criarUsuarioTab = document.getElementById('tab-criar-btn');
            if (criarUsuarioTab && !PermissionManager.hasPermission(PERMISSIONS.USUARIOS.CREATE)) {
                criarUsuarioTab.style.display = 'none';
            }
            
            // Carregar roles dispon√≠veis (com fallback imediato)
            await loadAvailableRoles();
            
            // Garantir que o dropdown sempre tenha op√ß√µes (fallback adicional)
            setTimeout(() => {
                const createRoleSelect = document.getElementById('user-perfil');
                if (createRoleSelect && createRoleSelect.children.length <= 1) {
                    console.log('üîß Aplicando fallback de seguran√ßa para dropdown de roles...');
                    createRoleSelect.innerHTML = `
                        <option value="">Selecione o tipo</option>
                        <option value="FUNCIONARIO">Funcion√°rio</option>
                        <option value="VENDEDOR">Vendedor</option>
                        <option value="DIRETOR">Diretor</option>
                        <option value="ADMIN">Administrador</option>
                    `;
                }
            }, 1000);
            
            // Carregar dados
            loadResumoMetricas();
            switchUsuariosTab('resumo');
            
            console.log('‚úÖ Sistema de permiss√µes configurado com sucesso!');
            console.log('üí° Execute demonstrarPermissoes() no console para ver as permiss√µes do usu√°rio atual');
        });
    </script>
</body>
</html>